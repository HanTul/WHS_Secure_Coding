{% extends "base.html" %}
{% block title %}ê´€ë¦¬ì í˜ì´ì§€{% endblock %}

{% block content %}
<h2 class="section-title">ğŸ“‹ ê´€ë¦¬ì ëŒ€ì‹œë³´ë“œ</h2>

<div class="admin-tabs">
  <a href="#reports">ğŸ“ ì‹ ê³  ëª©ë¡</a>
  <a href="#users">ğŸ‘¥ ìœ ì € ê´€ë¦¬</a>
  <a href="#products">ğŸ“¦ ìƒí’ˆ ê´€ë¦¬</a>
</div>

<div class="admin-section" id="reports">
  <h3 class="section-subtitle">ğŸ“ ì‹ ê³  ëª©ë¡</h3>
  <table class="admin-table">
    <thead>
      <tr>
        <th>ë²ˆí˜¸</th><th>ì‹ ê³ ì</th><th>ëŒ€ìƒ</th><th>ì‚¬ìœ </th><th>ë‚ ì§œ</th><th>ì²˜ë¦¬</th>
      </tr>
    </thead>
    <tbody>
      {% for r in reports %}
      <tr>
        <td>{{ loop.index }}</td>
        <td>{{ r.reporter.username }}{% if r.reporter.nickname %} ({{ r.reporter.nickname }}){% endif %}</td>
        <td>
          {% if r.target_type == 'user' and r.target_user %}
            {{ r.target_user.username }}{% if r.target_user.nickname %} ({{ r.target_user.nickname }}){% endif %}
          {% elif r.target_type == 'product' and r.target_product %}
            {{ r.target_product.name }} (ID: {{ r.target_product.id }})
          {% else %}?{% endif %}
        </td>
        <td>{{ r.reason }}</td>
        <td>{{ r.created_at.strftime('%Y-%m-%d') }}</td>
        <td>
          <form method="post" action="{{ url_for('resolve_report', rid=r.id) }}">
            <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
            <button class="btn-green">ì²˜ë¦¬ ì™„ë£Œ</button>
          </form>
        </td>
      </tr>
      {% else %}
      <tr><td colspan="6" class="empty-row">ì‹ ê³  ì—†ìŒ</td></tr>
      {% endfor %}
    </tbody>
  </table>
</div>

<div class="admin-section" id="users">
  <h3 class="section-subtitle">ğŸ‘¥ ìœ ì € ê´€ë¦¬</h3>

  <table class="admin-table">
    <thead>
      <tr><th>ID</th><th>ì•„ì´ë””</th><th>ë‹‰ë„¤ì„</th><th>ìƒíƒœ</th><th>ì¡°ì¹˜</th><th>ì‚­ì œ</th><th>ì„ì‹œë¹„ë²ˆ</th></tr>
    </thead>
    <tbody>
      {% for u in users %}
      <tr>
        <td>{{ loop.index }}</td>
        <td>{{ u.username }}</td>
        <td>{{ u.nickname or "-" }}</td>
        <td>{{ "ì •ì§€ë¨" if u.is_suspend else "ì •ìƒ" }}</td>
        <td>
          <form method="post" action="{{ url_for('suspend_user', uid=u.id) }}">
            <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
            <button class="btn-orange">{{ "ì •ì§€í•´ì œ" if u.is_suspend else "ì •ì§€" }}</button>
          </form>
        </td>
        <td>
          <form method="post" action="{{ url_for('delete_user', uid=u.id) }}" onsubmit="return confirm('ì •ë§ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?');">
            <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
            <button class="btn-red">ì‚­ì œ</button>
          </form>
        </td>
        <td>
          <form method="post" action="{{ url_for('temp_password', uid=u.id) }}">
            <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
            <button class="btn-blue">ì„ì‹œë¹„ë²ˆ</button>
          </form>
        </td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
</div>

<div class="admin-section" id="products">
  <h3 class="section-subtitle">ğŸ“¦ ìƒí’ˆ ê´€ë¦¬</h3>

  <table class="admin-table">
    <thead>
      <tr><th>ID</th><th>ì œëª©</th><th>íŒë§¤ì</th><th>ìƒíƒœ</th><th>ì¡°ì¹˜</th><th>ì‚­ì œ</th></tr>
    </thead>
    <tbody>
      {% for p in products %}
      <tr>
        <td>{{ loop.index }}</td>
        <td>{{ p.name }}</td>
        <td>{{ p.seller.username }}{% if p.seller.nickname %} ({{ p.seller.nickname }}){% endif %}</td>
        <td>{{ "ìˆ¨ê¹€" if p.removed else "ê³µê°œ" }}</td>
        <td>
          <form method="post" action="{{ url_for('toggle_product', pid=p.id) }}">
            <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
            <button class="btn-orange">{{ "ë³µêµ¬" if p.removed else "ìˆ¨ê¸°ê¸°" }}</button>
          </form>
        </td>
        <td>
          <form method="post" action="{{ url_for('delete_product', pid=p.id) }}" onsubmit="return confirm('ì •ë§ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?');">
            <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
            <button class="btn-red">ì‚­ì œ</button>
          </form>
        </td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
</div>
{% endblock %}
