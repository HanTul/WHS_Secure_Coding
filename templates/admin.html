{% extends "base.html" %}
{% block title %}ê´€ë¦¬ì í˜ì´ì§€{% endblock %}
{% block content %}

<h2>ğŸ“‹ ê´€ë¦¬ì ëŒ€ì‹œë³´ë“œ</h2>

<div style="display: flex; gap: 12px; margin-bottom: 20px;">
  <a href="#reports">ğŸ“ ì‹ ê³  ëª©ë¡</a>
  <a href="#users">ğŸ‘¥ ìœ ì € ê´€ë¦¬</a>
  <a href="#products">ğŸ“¦ ìƒí’ˆ ê´€ë¦¬</a>
</div>

<hr>

<h3 id="reports">ğŸ“ ì‹ ê³  ëª©ë¡</h3>
<table border="1" cellpadding="6" cellspacing="0">
  <tr>
    <th>ë²ˆí˜¸</th>
    <th>ì‹ ê³ ì</th>
    <th>ëŒ€ìƒ</th>
    <th>ì‚¬ìœ </th>
    <th>ë‚ ì§œ</th>
    <th>ì²˜ë¦¬</th>
  </tr>
  {% for r in reports %}
    <tr>
      <td>{{ r.id }}</td>
      <td>
        {{ r.reporter.username }}
        {% if r.reporter.nickname %} ({{ r.reporter.nickname }}){% endif %}
      </td>
      <td>
        {% if r.target_type == 'user' and r.target_user %}
          {{ r.target_user.username }}
          {% if r.target_user.nickname %} ({{ r.target_user.nickname }}){% endif %}
        {% elif r.target_type == 'product' and r.target_product %}
          {{ r.target_product.name }} (ID: {{ r.target_product.id }})
        {% else %}
          ?
        {% endif %}
      </td>
      <td>{{ r.reason }}</td>
      <td>{{ r.created_at.strftime('%Y-%m-%d') }}</td>
      <td>
        <form method="post" action="{{ url_for('resolve_report', rid=r.id) }}">
          <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
          <button>ì²˜ë¦¬ ì™„ë£Œ</button>
        </form>
      </td>
    </tr>
  
  {% else %}
    <tr><td colspan="6">ì‹ ê³  ì—†ìŒ</td></tr>
  {% endfor %}
</table>

<hr>

<h3 id="users">ğŸ‘¥ ìœ ì € ê´€ë¦¬</h3>
<table border="1" cellpadding="6" cellspacing="0">
  <tr>
    <th>ID</th>
    <th>ì•„ì´ë””</th>
    <th>ë‹‰ë„¤ì„</th>
    <th>ìƒíƒœ</th>
    <th>ì¡°ì¹˜</th>
  </tr>
  {% for u in users %}
    <tr>
      <td>{{ u.id }}</td>
      <td>{{ u.username }}</td>
      <td>{{ u.nickname or "-" }}</td>
      <td>{{ "ì •ì§€ë¨" if u.is_suspend else "ì •ìƒ" }}</td>
      <td>
        <form method="post" action="{{ url_for('suspend_user', uid=u.id) }}">
          <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
          <button>{{ "ì •ì§€í•´ì œ" if u.is_suspend else "ì •ì§€" }}</button>
        </form>
      </td>
    </tr>
  {% endfor %}
</table>

<hr>

  <h3 id="products">ğŸ“¦ ìƒí’ˆ ê´€ë¦¬</h3>
  <table border="1" cellpadding="6" cellspacing="0">
    <tr>
      <th>ID</th>
      <th>ì œëª©</th>
      <th>íŒë§¤ì</th>
      <th>ìƒíƒœ</th>
      <th>ì¡°ì¹˜</th>
    </tr>
    {% for p in products %}
      <tr>
        <td>{{ p.id }}</td>
        <td>{{ p.name }}</td>
        <td>
          {{ p.seller.username }}
          {% if p.seller.nickname %}
            ({{ p.seller.nickname }})
          {% endif %}
        </td>
        <td>{{ "ìˆ¨ê¹€" if p.removed else "ê³µê°œ" }}</td>
        <td>
          <form method="post" action="{{ url_for('toggle_product', pid=p.id) }}">
            <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
            <button>{{ "ë³µêµ¬" if p.removed else "ìˆ¨ê¸°ê¸°" }}</button>
          </form>
        </td>
      </tr>
    {% endfor %}
  </table>


{% endblock %}
